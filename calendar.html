<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calendrier avec export/import complet TXT</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

  :root {
    --bg: #121212;
    --card-bg: #1f1f2e;
    --card-hover: #2a2a3a;
    --accent: #999999;
    --accent-light: #b3b3b3;
    --text-primary: #e0e0e0;
    --text-secondary: #888888;
    --border-color: #333344;
    --shadow: rgba(0,0,0,0.7);
    --btn-del-bg: #cc4444;
    --btn-del-hover: #aa2222;
  }

  * {
    box-sizing: border-box;
  }

  body {
    background: var(--bg);
    color: var(--text-primary);
    font-family: 'Poppins', sans-serif;
    max-width: 720px;
    margin: 40px auto;
    padding: 0 24px;
  }

  h1 {
    text-align: center;
    font-weight: 600;
    font-size: 2.4rem;
    margin-bottom: 10px;
    color: var(--accent);
    user-select: none;
  }

  #nextDay {
    text-align: center;
    font-size: 1.15rem;
    margin-bottom: 30px;
    color: var(--accent-light);
    font-weight: 600;
  }

  form#addForm {
    background: var(--card-bg);
    padding: 16px 20px;
    border-radius: 16px;
    box-shadow: 0 10px 28px var(--shadow);
    margin-bottom: 20px;
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    align-items: flex-end;
  }

  form#addForm > div {
    flex: 1 1 140px;
    min-width: 140px;
  }

  label {
    display: block;
    font-weight: 600;
    color: var(--accent-light);
    margin-bottom: 4px;
    font-size: 0.9rem;
  }

  input[type="date"],
  input[type="time"],
  input[type="text"] {
    width: 100%;
    padding: 8px 10px;
    border-radius: 10px;
    border: 2px solid transparent;
    background-color: #2c2c44;
    color: var(--text-primary);
    font-size: 0.95rem;
    transition: border-color 0.3s ease, background-color 0.3s ease;
  }

  input[type="date"]:focus,
  input[type="time"]:focus,
  input[type="text"]:focus {
    outline: none;
    border-color: var(--accent-light);
    background-color: #3a3a5a;
  }

  button#addBtn {
    background-color: var(--accent);
    border: none;
    color: white;
    padding: 10px 24px;
    border-radius: 20px;
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    user-select: none;
    flex-shrink: 0;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
    box-shadow: 0 6px 18px rgb(153 153 153 / 0.6);
  }

  button#addBtn:hover,
  button#addBtn:focus-visible {
    background-color: var(--accent-light);
    outline: none;
    box-shadow: 0 8px 26px rgb(179 179 179 / 0.9);
  }

  .actions-bar {
    margin-bottom: 30px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
  }

  button, input[type="file"] {
    padding: 8px 16px;
    border-radius: 8px;
    border: none;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    user-select: none;
    background-color: var(--card-bg);
    color: var(--text-primary);
    box-shadow: 0 4px 16px var(--shadow);
    transition: background-color 0.3s ease;
  }

  button:hover {
    background-color: var(--card-hover);
  }

  input[type="file"] {
    cursor: pointer;
  }

  table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 12px;
    font-feature-settings: "tnum";
  }

  thead th {
    text-align: left;
    font-weight: 600;
    font-size: 1rem;
    color: var(--accent-light);
    padding: 12px 16px 8px;
    user-select: none;
    border-bottom: 2px solid var(--border-color);
  }

  tbody tr {
    background-color: var(--card-bg);
    border-radius: 20px;
    box-shadow: 0 5px 22px var(--shadow);
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
  }

  tbody tr:hover,
  tbody tr:focus-within {
    background-color: var(--card-hover);
    box-shadow: 0 10px 36px var(--shadow);
  }

  td {
    padding: 12px 16px;
    font-weight: 500;
    font-size: 0.95rem;
    vertical-align: middle;
    color: var(--text-primary);
    user-select: text;
    font-variant-numeric: tabular-nums;
  }

  td.date {
    color: var(--text-secondary);
    user-select: none;
  }

  td.actions {
    width: 60px;
    text-align: center;
  }

  button.btn-delete {
    background-color: var(--btn-del-bg);
    border: none;
    color: white;
    padding: 8px 12px;
    border-radius: 50%;
    font-weight: 700;
    font-size: 1.1rem;
    cursor: pointer;
    transition: background-color 0.25s ease;
    user-select: none;
    line-height: 1;
  }

  button.btn-delete:hover,
  button.btn-delete:focus-visible {
    background-color: var(--btn-del-hover);
    outline: none;
  }

  @media (max-width: 600px) {
    form#addForm {
      flex-direction: column;
      padding: 16px;
      gap: 18px;
    }
    form#addForm > div {
      min-width: auto;
      width: 100%;
    }
    button#addBtn {
      width: 100%;
      padding: 14px 0;
      font-size: 1.1rem;
      box-shadow: 0 8px 26px rgb(179 179 179 / 0.9);
    }
    td, th {
      padding: 10px 12px;
      font-size: 0.9rem;
    }
    td.actions {
      width: 50px;
    }
    button.btn-delete {
      padding: 7px 10px;
      font-size: 1rem;
    }
  }
</style>
</head>
<body>

<h1>Calendrier rendez-vous</h1>
<div id="nextDay" aria-live="polite"></div>

<form id="addForm" aria-label="Ajouter un événement">
  <div>
    <label for="dateInput">Date</label>
    <input type="date" id="dateInput" required />
  </div>
  <div>
    <label for="timeInput">Heure</label>
    <input type="time" id="timeInput" required />
  </div>
  <div>
    <label for="descInput">Description</label>
    <input type="text" id="descInput" placeholder="Ex: Réunion, RDV" required />
  </div>
  <button type="submit" id="addBtn">Ajouter</button>
</form>

<div class="actions-bar">
  <button id="exportBtn" type="button" title="Exporter rendez-vous (date;heure;description)">Exporter RDV (.txt)</button>
  <input type="file" id="importFile" accept=".txt" style="display:none" />
  <button id="importBtn" type="button">Importer RDV (.txt)</button>
</div>

<table aria-label="Tableau des événements">
  <thead>
    <tr>
      <th>Date</th>
      <th>Jour</th>
      <th>Heure</th>
      <th>Description</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="eventsBody" tabindex="0">
    <!-- Événements ajoutés ici -->
  </tbody>
</table>

<script>
  const addForm = document.getElementById('addForm');
  const eventsBody = document.getElementById('eventsBody');
  const nextDayDiv = document.getElementById('nextDay');
  const exportBtn = document.getElementById('exportBtn');
  const importBtn = document.getElementById('importBtn');
  const importFile = document.getElementById('importFile');

  const jours = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];

  let events = [];

  function render() {
    eventsBody.innerHTML = '';

    events.sort((a,b) => {
      if (a.date === b.date) return a.time.localeCompare(b.time);
      return a.date.localeCompare(b.date);
    });

    events.forEach((ev, idx) => {
      const tr = document.createElement('tr');

      const tdDate = document.createElement('td');
      tdDate.textContent = ev.date || '';
      tdDate.classList.add('date');
      tr.appendChild(tdDate);

      const tdJour = document.createElement('td');
      tdJour.textContent = ev.date ? jours[new Date(ev.date).getDay()] || '' : '';
      tr.appendChild(tdJour);

      const tdTime = document.createElement('td');
      tdTime.textContent = ev.time || '';
      tr.appendChild(tdTime);

      const tdDesc = document.createElement('td');
      tdDesc.textContent = ev.desc;
      tr.appendChild(tdDesc);

      const tdActions = document.createElement('td');
      tdActions.classList.add('actions');

      const btnDel = document.createElement('button');
      btnDel.textContent = '×';
      btnDel.className = 'btn-delete';
      btnDel.title = 'Supprimer cet événement';
      btnDel.addEventListener('click', () => {
        events.splice(idx, 1);
        render();
        updateNextDay();
      });

      tdActions.appendChild(btnDel);
      tr.appendChild(tdActions);

      eventsBody.appendChild(tr);
    });
  }

  function updateNextDay() {
    if(events.length === 0) {
      nextDayDiv.textContent = 'Aucun rendez-vous programmé.';
      return;
    }
    const today = new Date();
    const todayISO = today.toISOString().slice(0,10);
    const futureEvents = events.filter(ev => ev.date && ev.date >= todayISO);
    if(futureEvents.length === 0) {
      nextDayDiv.textContent = 'Aucun rendez-vous futur programmé.';
      return;
    }
    futureEvents.sort((a,b) => {
      if (a.date === b.date) return a.time.localeCompare(b.time);
      return a.date.localeCompare(b.date);
    });
    const prochain = futureEvents[0];
    const jourProchain = jours[new Date(prochain.date).getDay()] || '';
    nextDayDiv.textContent = `Prochain rendez-vous : ${jourProchain} ${prochain.date} à ${prochain.time}`;
  }

  addForm.addEventListener('submit', e => {
    e.preventDefault();

    const date = document.getElementById('dateInput').value;
    const time = document.getElementById('timeInput').value;
    const desc = document.getElementById('descInput').value.trim();

    if (!date || !time || !desc) {
      alert('Remplissez tous les champs');
      return;
    }

    // Vérifier doublon date + heure
    const exists = events.some(ev => ev.date === date && ev.time === time);
    if(exists) {
      alert('Un événement existe déjà à cette date et heure.');
      return;
    }

    events.push({date, time, desc});
    render();
    updateNextDay();

    addForm.reset();
  });

  // Export tous détails : date;heure;description par ligne
  exportBtn.addEventListener('click', () => {
    if(events.length === 0) {
      alert('Aucun rendez-vous à exporter.');
      return;
    }
    const lines = events.map(ev => `${ev.date};${ev.time};${ev.desc}`);
    const blob = new Blob([lines.join('\n')], {type: 'text/plain'});
    const url = URL.createObjectURL(blob);

    const a = document.createElement('a');
    a.href = url;
    a.download = 'rendezvous.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  });

  // Import fichier TXT format date;heure;description par ligne
  importBtn.addEventListener('click', () => importFile.click());

  importFile.addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = ev => {
      const text = ev.target.result;
      const lines = text.split(/\r?\n/).map(l => l.trim()).filter(l => l.length > 0);
      if(lines.length === 0) {
        alert('Le fichier est vide ou invalide.');
        return;
      }
      const imported = [];
      for(let i=0; i<lines.length; i++) {
        const parts = lines[i].split(';');
        if(parts.length < 3) {
          alert(`Format invalide à la ligne ${i+1}. Format attendu : date;heure;description`);
          return;
        }
        const date = parts[0].trim();
        const time = parts[1].trim();
        const desc = parts.slice(2).join(';').trim(); // en cas de ; dans description
        if(!date || !time || !desc) {
          alert(`Champs manquants à la ligne ${i+1}.`);
          return;
        }
        imported.push({date, time, desc});
      }
      events = imported;
      render();
      updateNextDay();
    };
    reader.readAsText(file);
    importFile.value = ''; // reset input
  });

  render();
  updateNextDay();
</script>

</body>
</html>
